<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Leaf"><title>NODEJS · Leaf</title><meta name="description" content="核心依赖
http url fs ...
npm npmjs.com
1234567&amp;lt;- npm -v&amp;lt;- npm install [name] --save &amp;#x2F;&amp;#x2F;安装依赖包npm uninstall [name]npm list &amp;#x2F;&amp;#x2F;查看所有的包"><meta name="keywords" content="Blog"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.0.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Leaf</a></h3><div class="description"><p>一片叶子.<br />Leaf On The Road.</p></div></div></div><ul class="social-links"><li><a href="https://github.com/leafon/leafon.github.io"><i class="fa fa-github"></i></a></li><li><a href="516037580@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a href="https://github.com/leafon/leafon.github.io"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Leaf</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core.  </a><a href="http://www.beian.miit.gov.cn/" target="_blank">&nbsp;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li><li><a href="/guestbook">留言</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>NODEJS</a></h3></div><div class="post-content"><h3 id="核心依赖"><a href="#核心依赖" class="headerlink" title="核心依赖"></a>核心依赖</h3><hr>
<p><code>http url fs ...</code></p>
<h3 id="npm-npmjs-com"><a href="#npm-npmjs-com" class="headerlink" title="npm npmjs.com"></a>npm npmjs.com</h3><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;- npm -v</span><br><span class="line">&lt;- npm install [name] --save &#x2F;&#x2F;安装依赖包</span><br><span class="line">npm uninstall [name]</span><br><span class="line">npm list &#x2F;&#x2F;查看所有的包</span><br><span class="line">&lt;- npm install name@2.0.1 --save &#x2F;&#x2F;指定包的版本</span><br><span class="line">&lt;- npm i &#x2F;&#x2F;install all dependencies</span><br><span class="line">&lt;- npm info name &#x2F;&#x2F;查看包的信息</span><br></pre></td></tr></table></figure>
<p>dependencies依赖包的版本管理<br>^第一位版本号不变，后两位取最新<br>～前两位不变，最后一位取最新<br>*最新版本<br>默认指定版本</p>
<h3 id="创建package-json"><a href="#创建package-json" class="headerlink" title="创建package.json"></a>创建package.json</h3><hr>
<p><code> npm init || npm init --yes</code></p>
<h2 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; fs 异步操作</span><br><span class="line">1. fs.stat 检测是文件还是目录</span><br><span class="line">2. fs.mkdir 创建目录</span><br><span class="line">3. fs.writeFile 创建写入文件，覆盖源文件</span><br><span class="line">4. fs.appendFile 追加文件，追加文件内容</span><br><span class="line">5. fs.readFile 读取文件</span><br><span class="line">6. fs.readdir 读取目录</span><br><span class="line">7. fs.rename 重命名，还可以移动文件</span><br><span class="line">8. fs.rmdir 删除目录</span><br><span class="line">9. s.unlink 删除文件</span><br><span class="line">    isDirectory()检测文件是否是目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="检测目录里的所有目录"><a href="#检测目录里的所有目录" class="headerlink" title="检测目录里的所有目录"></a>检测目录里的所有目录</h4><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; async await</span><br><span class="line">const fs &#x3D; require(&quot;fs)</span><br><span class="line">let alldir &#x3D; [];</span><br><span class="line">async function isDir(path)&#123;</span><br><span class="line">    return new Promise((resolve, reject)&#x3D;&gt;&#123;</span><br><span class="line">        fs.stat(path,(err,stats)&#x3D;&gt;&#123;</span><br><span class="line">            if(err)&#123;</span><br><span class="line">                reject(err)</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            if(stats.isDirectory())&#123;</span><br><span class="line">                resolve(true)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                resolve(false)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function main()&#123;</span><br><span class="line">    fs.readdir(&#39;.&#x2F;&#39;,async (err,data)&#x3D;&gt;&#123;</span><br><span class="line">        if(err)&#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        for(let i&#x3D;0;i&lt;data.length;i++)&#123;</span><br><span class="line">            if(await isDir(&#39;.&#x2F;&#39;+data[i]))&#123;</span><br><span class="line">                alldir.push(data[i])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&#39;alldir&#x3D;&#39;,alldir)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">main();</span><br></pre></td></tr></table></figure>
<h4 id="流文件"><a href="#流文件" class="headerlink" title="流文件"></a>流文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt; 读取流／写入流／管道流</span><br><span class="line">const fs &#x3D; require(&quot;fs&quot;)</span><br><span class="line">&#x2F;&#x2F;读取流</span><br><span class="line">var readStream &#x3D; fs.createReadStream(&#39;.&#x2F;readme.txt&#39;);</span><br><span class="line">var str &#x3D; &#39;&#39;;</span><br><span class="line">var count &#x3D; 0;</span><br><span class="line">readStream.on(&#39;data&#39;,data&#x3D;&gt;&#123;</span><br><span class="line">    str +&#x3D; data</span><br><span class="line">    count++</span><br><span class="line">&#125;)</span><br><span class="line">readStream.on(&#39;end&#39;,err&#x3D;&gt;&#123;</span><br><span class="line">    if(!err)&#123;</span><br><span class="line">        console.log(str)</span><br><span class="line">        console.log(count)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F;写入流</span><br><span class="line">var str &#x3D; &quot;zai wujin de heiye.wo hai you meng, jiu neng kan dao cai hong!&quot;</span><br><span class="line">var wr &#x3D; fs.createWriteStream(&#39;.&#x2F;wr.txt&#39;);</span><br><span class="line"></span><br><span class="line">wr.write(str);</span><br><span class="line">wr.end();&#x2F;&#x2F;标记写入完成</span><br><span class="line">wr.on(&#39;finish&#39;,()&#x3D;&gt;&#123;</span><br><span class="line">    console.log(&#39;write over!&#39;)</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F;管道流</span><br><span class="line">var readStr &#x3D; fs.createReadStream(&#39;.&#x2F;wr.txt&#39;);</span><br><span class="line">var writeStr &#x3D; fs.createWriteStream(&#39;.&#x2F;copy.txt&#39;);</span><br><span class="line">readStr.pipe(writeStr);</span><br></pre></td></tr></table></figure>

<h2 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 简单静态web服务器 app.js</span><br><span class="line">const http &#x3D; require(&quot;http&quot;)</span><br><span class="line">const fs &#x3D; require(&quot;fs&quot;)</span><br><span class="line">const path &#x3D; require(&#39;path&#39;)&#x2F;&#x2F;获取文件后缀名</span><br><span class="line">const url &#x3D; require(&#39;url&#39;)&#x2F;&#x2F;获取不带参数的url路径url.parse(req.url).pathname</span><br><span class="line">const setname &#x3D; require(&#39;.&#x2F;name.js&#39;)</span><br><span class="line">http.createServer((req, res) &#x3D;&gt; &#123;</span><br><span class="line">    let pathurl &#x3D; url.parse(req.url).pathname;</span><br><span class="line">    pathurl &#x3D; pathurl &#x3D;&#x3D;&#39;&#x2F;&#39;?&#39;index.htm&#39;:pathurl;</span><br><span class="line">    let extname &#x3D; path.extname(pathurl);</span><br><span class="line">    if(pathurl !&#x3D; &#39;&#x2F;favicon.ico&#39;)&#123;</span><br><span class="line">        fs.readFile(&#39;.&#x2F;htm&#39;+pathurl,async (err,data)&#x3D;&gt;&#123;</span><br><span class="line">            if(err)&#123;</span><br><span class="line">                res.writeHead(200,&#123;&quot;Content-type&quot;:&quot;text&#x2F;html;charset&#x3D;&#39;utf-8&#39;&quot;&#125;)</span><br><span class="line">                res.end(&#39;404&#39;);</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            let seth &#x3D; await setname.getFileName(extname)</span><br><span class="line">            res.writeHead(200,&#123;&quot;Content-type&quot;:seth+&quot;;charset&#x3D;&#39;utf-8&#39;&quot;&#125;)</span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(4000);</span><br><span class="line">&#x2F;&#x2F; server running at http:&#x2F;&#x2F;127.0.0.1:4000&#x2F;</span><br><span class="line">&#x2F;&#x2F;处理资源类型响应</span><br><span class="line">const fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line">const &#123; json &#125; &#x3D; require(&#39;body-parser&#39;);</span><br><span class="line">exports.getFileName &#x3D; function(extname)&#123;</span><br><span class="line">    return new Promise((resolve, reject)&#x3D;&gt;&#123;</span><br><span class="line">        fs.readFile(&#39;.&#x2F;data.name.json&#39;,(err,data)&#x3D;&gt;&#123;&#x2F;&#x2F;异步方法</span><br><span class="line">            if(err)&#123;</span><br><span class="line">                reject(err);</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">            let jsondata &#x3D; JSON.parse(data.toString());</span><br><span class="line">            resolve(jsondata[extname])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 同步读取方法</span><br><span class="line">&#x2F;&#x2F; var jsondata &#x3D; fs.readFileSync(&#39;.&#x2F;data&#x2F;name.json&#39;);</span><br><span class="line">&#x2F;&#x2F; left needdata &#x3D; JSON.parse(jsondata.toString());</span><br><span class="line">&#x2F;&#x2F; return needdata[extname]</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;封装静态服务 -- test</span><br></pre></td></tr></table></figure>

<h2 id="ejs模版引擎"><a href="#ejs模版引擎" class="headerlink" title="ejs模版引擎"></a>ejs模版引擎</h2><hr>
<p>npm install ejs –save<br>let template = ejs.compile(str, options)<br>template(data);<br>ejs.render(str, data, options)<br>ejs.readerFile(filename, data, options, function(err, str){</p>
<p>})</p>
<p>if(pathname == ‘/login’){<br>    let msg = ‘获取的数据’;<br>    ejs.renderFile(‘./views/login.ejs’,{msg:msg},(err,data){<br>        res.writeHead(200,{“Content-type”:seth+”;charset=’utf-8’”})<br>        res.end(data)<br>    })<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### get post传值</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>//获取get传值<br>    var query = url.parse(req.url,true).query;<br>    //query.name query.page<br>    //请求方式 req.method<br>// 获取post请求<br>    let postdata = ‘’;<br>    req.on(‘data’,(chunk)=&gt;{<br>        postData += chunk;<br>    })<br>    req.on(‘end’,()=&gt;{<br>        console.log(postData);<br>        res.end(postData);<br>    })</p>
<pre><code></code></pre>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-08-18</span><i class="fa fa-tag"></i><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://github.com/leafon/leafon.github.io/2020/08/18/nodejs/,Leaf,NODEJS,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/08/03/Go/" title="Golang study - 01">下一篇</a></li></ul></div><script src="/js/visitors.js"></script><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'',
  app_key:'',
  placeholder:'命途多舛、痴迷淡然...',
  path: window.location.pathname,
  serverURLs: '',
  visitor:true,
  recordIP:true,
  avatar:'mp'
})</script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/baidu-tongji.js"></script></body></html>