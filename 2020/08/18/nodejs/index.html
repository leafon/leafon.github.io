<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Leaf"><title>NODEJS · Leaf</title><meta name="description" content="核心依赖http url fs ...
npm npmjs.com1234567&amp;gt; npm -v&amp;gt; npm install [name] --save //安装依赖包npm uninstall [name]npm list //查看所有的包&amp;gt; npm install name@2."><meta name="keywords" content="Blog"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.0.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Leaf</a></h3><div class="description"><p>一片叶子.<br />Leaf On The Road.</p></div></div></div><ul class="social-links"><li><a href="https://github.com/leafon/leafon.github.io"><i class="fa fa-github"></i></a></li><li><a href="516037580@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY="><i class="fa fa-qq"></i></a></li><li><a href="https://github.com/leafon/leafon.github.io"><i class="fa fa-mortar-board"></i></a></li></ul><div class="footer"><div class="p"> <span>© 2020 </span><i class="fa fa-star"></i><span> Leaf</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core.  </a><a href="http://www.beian.miit.gov.cn/" target="_blank">&nbsp;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>NODEJS</a></h3></div><div class="post-content"><h2 id="核心依赖"><a href="#核心依赖" class="headerlink" title="核心依赖"></a>核心依赖</h2><p><code>http url fs ...</code></p>
<h2 id="npm-npmjs-com"><a href="#npm-npmjs-com" class="headerlink" title="npm npmjs.com"></a>npm <a target="_blank" rel="noopener" href="https://npmjs.com/">npmjs.com</a></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm -v</span><br><span class="line">&gt; npm install [name] --save <span class="comment">//安装依赖包</span></span><br><span class="line">npm uninstall [name]</span><br><span class="line">npm list <span class="comment">//查看所有的包</span></span><br><span class="line">&gt; npm install name@<span class="number">2.0</span><span class="number">.1</span> --save <span class="comment">//指定包的版本</span></span><br><span class="line">&gt; npm i <span class="comment">//install all dependencies</span></span><br><span class="line">&gt; npm info name <span class="comment">//查看包的信息</span></span><br></pre></td></tr></table></figure>
<ul>
<li>dependencies 依赖包的版本管理<ul>
<li>^第一位版本号不变，后两位取最新</li>
<li>～前两位不变，最后一位取最新</li>
<li>*最新版本</li>
<li>默认指定版本</li>
</ul>
</li>
</ul>
<h2 id="创建package-json"><a href="#创建package-json" class="headerlink" title="创建package.json"></a>创建package.json</h2><p><code> npm init || npm init --yes</code></p>
<h2 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h2><ul>
<li>fs 异步操作<ol>
<li>fs.stat 检测是文件还是目录</li>
<li>fs.mkdir 创建目录</li>
<li>fs.writeFile 创建写入文件，覆盖源文件</li>
<li>fs.appendFile 追加文件，追加文件内容</li>
<li>fs.readFile 读取文件</li>
<li>fs.readdir 读取目录</li>
<li>fs.rename 重命名，还可以移动文件</li>
<li>fs.rmdir 删除目录</li>
<li>s.unlink 删除文件</li>
</ol>
</li>
</ul>
<p>isDirectory()检测文件是否是目录</p>
<h3 id="检测目录里的所有目录"><a href="#检测目录里的所有目录" class="headerlink" title="检测目录里的所有目录"></a>检测目录里的所有目录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async await</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs)</span></span><br><span class="line"><span class="string">let alldir = [];</span></span><br><span class="line"><span class="string">async function isDir(path)&#123;</span></span><br><span class="line"><span class="string">    return new Promise((resolve, reject)=&gt;&#123;</span></span><br><span class="line"><span class="string">        fs.stat(path,(err,stats)=&gt;&#123;</span></span><br><span class="line"><span class="string">            if(err)&#123;</span></span><br><span class="line"><span class="string">                reject(err)</span></span><br><span class="line"><span class="string">                return</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            if(stats.isDirectory())&#123;</span></span><br><span class="line"><span class="string">                resolve(true)</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                resolve(false)</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">function main()&#123;</span></span><br><span class="line"><span class="string">    fs.readdir(&#x27;./&#x27;,async (err,data)=&gt;&#123;</span></span><br><span class="line"><span class="string">        if(err)&#123;</span></span><br><span class="line"><span class="string">            return</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        for(let i=0;i&lt;data.length;i++)&#123;</span></span><br><span class="line"><span class="string">            if(await isDir(&#x27;./&#x27;+data[i]))&#123;</span></span><br><span class="line"><span class="string">                alldir.push(data[i])</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        console.log(&#x27;alldir=&#x27;,alldir)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">main();</span></span><br></pre></td></tr></table></figure>
<h3 id="流文件"><a href="#流文件" class="headerlink" title="流文件"></a>流文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取流／写入流／管道流</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="comment">//读取流</span></span><br><span class="line"><span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">&#x27;./readme.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">readStream.on(<span class="string">&#x27;data&#x27;</span>,<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    str += data</span><br><span class="line">    count++</span><br><span class="line">&#125;)</span><br><span class="line">readStream.on(<span class="string">&#x27;end&#x27;</span>,<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(str)</span><br><span class="line">        <span class="built_in">console</span>.log(count)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//写入流</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;zai wujin de heiye.wo hai you meng, jiu neng kan dao cai hong!&quot;</span></span><br><span class="line"><span class="keyword">var</span> wr = fs.createWriteStream(<span class="string">&#x27;./wr.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line">wr.write(str);</span><br><span class="line">wr.end();<span class="comment">//标记写入完成</span></span><br><span class="line">wr.on(<span class="string">&#x27;finish&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;write over!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//管道流</span></span><br><span class="line"><span class="keyword">var</span> readStr = fs.createReadStream(<span class="string">&#x27;./wr.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> writeStr = fs.createWriteStream(<span class="string">&#x27;./copy.txt&#x27;</span>);</span><br><span class="line">readStr.pipe(writeStr);</span><br></pre></td></tr></table></figure>

<h2 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单静态web服务器 app.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)<span class="comment">//获取文件后缀名</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)<span class="comment">//获取不带参数的url路径url.parse(req.url).pathname</span></span><br><span class="line"><span class="keyword">const</span> setname = <span class="built_in">require</span>(<span class="string">&#x27;./name.js&#x27;</span>)</span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pathurl = url.parse(req.url).pathname;</span><br><span class="line">    pathurl = pathurl ==<span class="string">&#x27;/&#x27;</span>?<span class="string">&#x27;index.htm&#x27;</span>:pathurl;</span><br><span class="line">    <span class="keyword">let</span> extname = path.extname(pathurl);</span><br><span class="line">    <span class="keyword">if</span>(pathurl != <span class="string">&#x27;/favicon.ico&#x27;</span>)&#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./htm&#x27;</span>+pathurl,<span class="keyword">async</span> (err,data)=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                res.writeHead(<span class="number">200</span>,&#123;<span class="string">&quot;Content-type&quot;</span>:<span class="string">&quot;text/html;charset=&#x27;utf-8&#x27;&quot;</span>&#125;)</span><br><span class="line">                res.end(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> seth = <span class="keyword">await</span> setname.getFileName(extname)</span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;<span class="string">&quot;Content-type&quot;</span>:seth+<span class="string">&quot;;charset=&#x27;utf-8&#x27;&quot;</span>&#125;)</span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">4000</span>);</span><br><span class="line"><span class="comment">// server running at http://127.0.0.1:4000/</span></span><br><span class="line"><span class="comment">//处理资源类型响应</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; json &#125; = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="built_in">exports</span>.getFileName = <span class="function"><span class="keyword">function</span>(<span class="params">extname</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        fs.readFile(<span class="string">&#x27;./data.name.json&#x27;</span>,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;<span class="comment">//异步方法</span></span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                reject(err);</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> jsondata = <span class="built_in">JSON</span>.parse(data.toString());</span><br><span class="line">            resolve(jsondata[extname])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 同步读取方法</span></span><br><span class="line"><span class="comment">// var jsondata = fs.readFileSync(&#x27;./data/name.json&#x27;);</span></span><br><span class="line"><span class="comment">// left needdata = JSON.parse(jsondata.toString());</span></span><br><span class="line"><span class="comment">// return needdata[extname]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//封装静态服务 -- test</span></span><br></pre></td></tr></table></figure>

<h2 id="ejs模版引擎"><a href="#ejs模版引擎" class="headerlink" title="ejs模版引擎"></a>ejs模版引擎</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs --save</span><br><span class="line"><span class="keyword">let</span> template = ejs.compile(str, options)</span><br><span class="line">template(data);</span><br><span class="line">ejs.render(str, data, options)</span><br><span class="line">ejs.readerFile(filename, data, options, <span class="function"><span class="keyword">function</span>(<span class="params">err, str</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(pathname == <span class="string">&#x27;/login&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> msg = <span class="string">&#x27;获取的数据&#x27;</span>;</span><br><span class="line">    ejs.renderFile(<span class="string">&#x27;./views/login.ejs&#x27;</span>,&#123;<span class="attr">msg</span>:msg&#125;,(err,data)&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;<span class="string">&quot;Content-type&quot;</span>:seth+<span class="string">&quot;;charset=&#x27;utf-8&#x27;&quot;</span>&#125;)</span><br><span class="line">        res.end(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="get-post传值"><a href="#get-post传值" class="headerlink" title="get post传值"></a>get post传值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取get传值</span></span><br><span class="line">    <span class="keyword">var</span> query = url.parse(req.url,<span class="literal">true</span>).query;</span><br><span class="line">    <span class="comment">//query.name query.page</span></span><br><span class="line">    <span class="comment">//请求方式 req.method</span></span><br><span class="line"><span class="comment">// 获取post请求</span></span><br><span class="line">    <span class="keyword">let</span> postdata = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>,<span class="function">(<span class="params">chunk</span>)=&gt;</span>&#123;</span><br><span class="line">        postData += chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(postData);</span><br><span class="line">        res.end(postData);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h2><ul>
<li>nodejs 8.0以上</li>
<li>npm init –生成package.json</li>
<li>npm install koa –save<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">&#x27;koa)</span></span><br><span class="line"><span class="string">var app = new koa();</span></span><br><span class="line"><span class="string">app.use(async ctx=&gt;&#123;</span></span><br><span class="line"><span class="string">    ctx.body = &#x27;</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">app.listen(4000)</span></span><br><span class="line"><span class="string">//express写法</span></span><br><span class="line"><span class="string">&lt;!-- app.use((req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;) --&gt;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<h4 id="koa-router"><a href="#koa-router" class="headerlink" title="koa-router"></a>koa-router</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-router --save</span><br><span class="line">ver Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)  -- <span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)();</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Koa();<span class="comment">//实例化</span></span><br><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">app.listen(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>
配置路由 ctx上下文，包含了request,response信息<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">ctx</span>)=&gt;</span>&#123;</span><br><span class="line"> ctx.body = <span class="string">&#x27;返回数据&#x27;</span></span><br><span class="line">&#125;).get(<span class="string">&#x27;/news&#x27;</span>,<span class="keyword">async</span> (ctx)=&gt;&#123;</span><br><span class="line">    ctx.body=<span class="string">&#x27;new page&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">ctx</span>)=&gt;</span>&#123;</span><br><span class="line"> ctx.body = <span class="string">&#x27;返回数据&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//启动路由</span></span><br><span class="line">app.use(router.routers())</span><br><span class="line">.use(router.allowedMethods())</span><br></pre></td></tr></table></figure>
获取get传值<br>router.get(‘/page’, ctx=&gt;{<br>  ctx.query – 参数对象<br>  ctx.querystring – 字符串<br>  ctx.request<br>  ctx.url / .host<br>})</li>
</ul>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/page/:aid&#x27;</span>, <span class="keyword">async</span> ctx=&gt;&#123;</span><br><span class="line">    ctx.params --&gt; [adi:canshu]</span><br><span class="line">    ctx.body = <span class="string">&#x27;page name&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/page/:aid/:cid&#x27;</span>,<span class="function"><span class="params">ctx</span>=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="koa-中间件"><a href="#koa-中间件" class="headerlink" title="koa 中间件"></a>koa 中间件</h3><p>+匹配路由之前做的一系列操作</p>
<ol>
<li>应用级中间件<br>//匹配所有路由,匹配路由之前操作<br>app.use(async (ctx,next)=&gt;{<br>ctx.body=’aaaa’<br>await next();//没有next，将终止路由匹配<br>})</li>
<li>路由中间件<br>app.use(‘/news’,async (ctx,next)=&gt;{<br>console.log(‘caozuo ‘);<br>await next();//没有next，将终止路由匹配<br>})<br>app.use(‘/news’,async (ctx)=&gt;{<br>ctx.body=’aaaa’<br>})</li>
<li>错误处理中间件 洋葱模式，从外到内，再从内到外<br>app.use(async (ctx,next)=&gt;{<br> //这是一个中间件,可以有多个中间件<br> next();<br> if(ctx.status == 404){<pre><code> ctx.status = 404
 ctx.body = &#39;404&#39;</code></pre>
 }<br>})</li>
<li>第三方中间件</li>
</ol>
<h3 id="ejs模版引擎使用"><a href="#ejs模版引擎使用" class="headerlink" title="ejs模版引擎使用"></a>ejs模版引擎使用</h3><ul>
<li>koa-views</li>
<li>ejs</li>
<li>views = require(‘koa-views’)</li>
<li>await ctx.render(‘index’)</li>
</ul>
<h3 id="koa-static"><a href="#koa-static" class="headerlink" title="koa-static"></a>koa-static</h3><ul>
<li>koa静态资源服务<ol>
<li>koa-static –save</li>
<li>const serve = require(‘koa-static’)</li>
<li>app.use(serve(‘staic目录’)); //可以配置多个<br>app.use(serve(__dirname+’staic目录’)); //__dirname当前目录<br>:4000/css/base.css 会从static目录中找</li>
</ol>
</li>
</ul>
<h4 id="art-template模版引擎"><a href="#art-template模版引擎" class="headerlink" title="art-template模版引擎"></a><a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/docs/syntax.html">art-template模版引擎</a></h4><hr>
<h3 id="文字渐变"><a href="#文字渐变" class="headerlink" title="文字渐变"></a>文字渐变</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">background-image</span><span class="selector-pseudo">:-webkit-linear-gradient(</span><span class="selector-id">#fff</span>,<span class="selector-id">#000</span>)</span><br><span class="line"><span class="selector-tag">-webkit-background-clip</span><span class="selector-pseudo">:text</span>;</span><br><span class="line"><span class="selector-tag">-webkit-text-fill-color</span><span class="selector-pseudo">:transparent</span>;</span><br></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-08-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/NODEJS/" title="NODEJS">NODEJS </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://github.com/leafon/leafon.github.io/2020/08/18/nodejs/,Leaf,NODEJS,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/08/20/%E6%B5%8F%E8%A7%88%E5%99%A8/" title="浏览器工作原理">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/08/03/Go/" title="Golang study - 01">下一篇</a></li></ul></div><script src="/js/visitors.js"></script><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'',
  app_key:'',
  placeholder:'命途多舛、痴迷淡然...',
  path: window.location.pathname,
  serverURLs: '',
  visitor:true,
  recordIP:true,
  avatar:'mp'
})</script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/baidu-tongji.js"></script></body></html>